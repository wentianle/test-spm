define("#umodel/1.0.0/umodel",["#jquery/1.8.2/jquery","#underscore/1.4.2/underscore","#backbone/0.9.2/backbone","$"],function(e,t,n){var r=e("#jquery/1.8.2/jquery"),i=e("#underscore/1.4.2/underscore"),s=e("#backbone/0.9.2/backbone");s.sync=function(){},t.Models=t.Models||{},r("#mskLoader").ajaxSend(function(e,t,n){n.type=="GET"&&r(this).show()}),r("#mskLoader").ajaxComplete(function(){r(this).hide()}),r("body").ajaxSuccess(function(e,t,n){t.done(function(e){e.ret_code==11040&&(window.location.href="/account/cas/login")})}),t.Models.Uhost=s.Model.extend({defaluts:{selected:!1},getTemplateJson:function(){var e=this.toJSON();switch(e.charge_type){case 1:e.charge_type_lable="按小时";break;case 2:e.charge_type_lable="按月";break;case 3:e.charge_type_lable="按年"}return e.vm_disk&&i.each(e.vm_disk,function(t){t.mount_device.indexOf("dev")===-1&&(t.mount_device="/dev/"+t.mount_device),t.bs_id?(e.net_disk=e.net_disk||[],e.net_disk.push(t)):(e.local_disk=e.local_disk||[],e.local_disk.push(t))}),e.public_ip_info&&i.each(e.public_ip_info,function(t){t.operator_id==10001?e.public_ip_ctc=t.ip_addr:t.operator_id==10002&&(e.public_ip_cnc=t.ip_addr)}),i.include([500,600,650,10,20,30,40,50],e.vm_state)?e.loader_display="inline":e.loader_display="none",e.create_time=r.format.date(new Date(parseInt(e.create_time)*1e3),"yyyy-MM-dd HH:mm"),e.charge_type==1?e.show_run_time=!0:e.show_run_time=!1,e.tag_info&&(e.tag_id=e.tag_info[0].tag_id,e.tag_name=e.tag_info[0].tag_name),e.vm_type&&(e.memory_unit=e.vm_type.memory_unit/1024),e.get_purchase_value=function(){if(e.charge_type!=1){var t=864e5,n=e.purchase_value*1e3-Date.parse(new Date);return Math.floor(n/t)+"天"}return""},e}}),t.Models.Udb=s.Model.extend({defaluts:{selected:!1},getTemplateJson:function(){var e=this.toJSON();switch(e.state){case 10:e.state_lable="初始化",e.state_key="600";break;case 20:e.state_lable="安装失败",e.state_key="610";break;case 30:e.state_lable="启动中",e.state_key="500";break;case 40:e.state_lable="运行中",e.state_key="510",e.change_group=1;break;case 50:e.state_lable="关闭中",e.state_key="600";break;case 60:e.state_lable="关闭",e.state_key="610",e.change_group=1}i.include([10,30,50],e.state)?e.loader_display="inline":e.loader_display="none",e.src_id==e.db_id||!e.src_id?e.src_lable="Master":e.src_lable="Slave",e.disk_space_usage&&(e.used_size=parseInt(e.disk_space_usage.used_size/1024),e.data_size=parseInt(e.disk_space_usage.data_file_size/1024),e.system_size=parseInt(e.disk_space_usage.system_file_size/1024),e.usable_size=parseInt(e.disk_space_usage.total_space/1024)-e.used_size);switch(e.charge_type){case 0:e.charge_lable="N/A";break;case 1:e.charge_lable="按小时";break;case 2:e.charge_lable="按月";break;case 3:e.charge_lable="按年"}return e.expire_time==0?e.expire_time="N/A":e.expire_time=r.format.date(new Date(parseInt(e.expire_time)*1e3),"yy-MM-dd HH:mm"),e.show_expire_time=function(){return e.charge_type!=0&&e.charge_type!=1?!0:!1},e.create_time=r.format.date(new Date(parseInt(e.create_time)*1e3),"yy-MM-dd HH:mm"),e},syncStatus:function(){var e=this;r.ajax({url:"/api/udb/state",data:{db_id:e.get("db_id"),use_session:"yes",format:"json"},type:"GET",cache:!1,dataType:"json",global:!1,success:function(t){t.ret_code==0&&(e.set(t.data),e.trigger("change"))},error:function(e){}})},syncDesc:function(){var e=this;r.ajax({url:"/api/udb/instances",data:{db_id:e.get("db_id"),need_space_usage:1,db_kind:1,use_session:"yes",format:"json"},type:"GET",cache:!1,dataType:"json",async:!1,success:function(t){t.ret_code==0&&(e.get("src_id")!=e.get("db_id")&&r.ajax({url:"/api/udb/instances",data:{db_id:e.get("src_id"),need_space_usage:0,db_kind:1,use_session:"yes",format:"json"},type:"GET",cache:!1,dataType:"json",async:!0,success:function(t){t.ret_code==0&&e.set("master_db_info",t.data)},error:function(e){}}),e.set(t.data[0]),e.trigger("change"))},error:function(e){}})}}),t.Models.DbInstance=s.Model.extend({defaluts:{selected:!1}}),t.Models.Isp=s.Model.extend({}),t.Models.Ufirewall=s.Model.extend({defaults:{disable:!1},getTemplateJson:function(){var e=this.toJSON();return e.create_time=r.format.date(new Date(parseInt(e.create_time)*1e3),"yyyy-MM-dd HH:mm"),e}}),t.Models.VmType=s.Model.extend({defaults:{selected:!1},getTemplateJson:function(){var e=this.toJSON();return e.cpu_unit=parseInt(e.cpu_unit)/10,e.memory_unit=parseInt(e.memory_unit)/1024,e}}),t.Models.Image=s.Model.extend({defaults:{selected:!1},getTemplateJson:function(){var e=this.toJSON();return e.loader_display="none",e.state==1&&(e.loader_display="inline"),e},syncStatus:function(){var e=this,t=this.toJSON();r.ajax({url:"/api/uimage",data:{image_id:e.get("image_id"),use_session:"yes",format:"json"},type:"GET",cache:!1,dataType:"json",global:!1,success:function(n){n.ret_code==0&&(t.desc=n.data,e.set(t),e.trigger("change"))},error:function(e){}})}}),t.Models.Udisk=s.Model.extend({defaults:{selected:!1},getTemplateJson:function(){var e=this.toJSON();return e.use_in_vm_device&&e.use_in_vm_device.indexOf("dev")==-1&&(e.use_in_vm_device="/dev/"+e.use_in_vm_device),i.include([1,3],e.status)?e.loader_display="inline":e.loader_display="none",e.update_time=r.format.date(new Date(parseInt(e.update_time)*1e3),"yyyy-MM-dd HH:mm"),e},syncStatus:function(){var e=this;r.ajax({url:"/api/udisk",data:{bs_id:e.get("bs_id"),use_session:"yes",format:"json"},type:"GET",cache:!1,dataType:"json",global:!1,success:function(t){t.ret_code==0&&e.set(t.data)},error:function(e){}})}}),t.Models.DbType=s.Model.extend({defaults:{selected:!1}}),t.Models.ClusterType=s.Model.extend({defaults:{selected:!1}}),t.Models.FactoryType=s.Model.extend({defaults:{selected:!1}}),t.Models.InstanceType=s.Model.extend({defaults:{selected:!1}}),t.Models.ParamGroup=s.Model.extend({defaults:{selected:!1}}),t.Models.BackupType=s.Model.extend({defaults:{selected:!1}}),t.Models.Backup=s.Model.extend({defaults:{selected:!1,visual:!0},getTemplateJson:function(){var e=this.toJSON();switch(e.backup_type){case 0:e.backup_type="自动";break;case 1:e.backup_type="手动"}switch(e.state){case 0:e.state_lable="备份中",e.state_key="500";break;case 1:e.state_lable="备份成功",e.state_key="510";break;case 2:e.state_lable="备份失败",e.state_key="600"}return e.backup_size=Math.ceil(e.backup_size/1048576),e.backup_time=r.format.date(new Date(parseInt(e.backup_time)*1e3),"yy-MM-dd HH:mm"),e}}),t.Models.Param=s.Model.extend({defaults:{selected:!1},syncStatus:function(){var e=this,t=this.toJSON();r.ajax({url:"/api/udb/paramdesc",data:{group_id:e.get("id"),use_session:"yes",format:"json"},type:"GET",cache:!1,dataType:"json",global:!1,success:function(n){n.ret_code==0&&(t.desc=n.data,e.set(t))},error:function(e){}})}}),t.Models.Snapshot=s.Model.extend({defaults:{selected:!1},getTemplateJson:function(){var e=this.toJSON();return e.create_time=r.format.date(new Date(parseInt(e.create_time)*1e3),"yyyy-MM-dd HH:mm"),e}}),t.Models.NetInfo=s.Model.extend({defaults:{selected:!1}}),t.Models.UfirewallRule=s.Model.extend({defaults:{action:"ACCEPT"},getTemplateJson:function(){var e=this.toJSON();switch(e.proto_type){case 1:e.proto_type_desc="TCP";break;case 2:e.proto_type_desc="UDP";break;case 3:e.proto_type_desc="ICMP"}return e}}),t.Models.Probe=s.Model.extend({defaults:{action:"ACCEPT"},getTemplateJson:function(){var e=this.toJSON();switch(e.probe_type){case 1:e.probe_type="PING";break;case 2:e.probe_type="TCP";break;case 3:e.probe_type="UDP"}return e}}),t.Models.AlarmTarget=s.Model.extend({}),t.Models.Indicator=s.Model.extend({}),t.Models.Tag=s.Model.extend({}),t.Models.MonitorCurrentData=s.Model.extend({defaults:{selected:!1}}),t.Models.Palarm=s.Model.extend({defaults:{selected:!1},getTemplateJson:function(){var e=this.toJSON();switch(e.alarm_type){case 10:e.alarm_type="严重";break;case 20:e.alarm_type="告警";break;case 30:e.alarm_type="通知"}return e}}),t.Models.Ucdn=s.Model.extend({defaults:{selected:!1},getTemplateJson:function(){var e=this.toJSON();switch(e.status){case 0:e.status_lable="审核中";break;case 1:e.status_lable="审核通过";break;case 2:e.status_lable="审核未过";break;case 3:e.status_lable="加速中"}return e.create_time=r.format.date(new Date(parseInt(e.create_time)*1e3),"yyyy-MM-dd HH:mm"),e}}),t.Models.UcdnTraffic=s.Model.extend({getTraffic:function(e){var t=this;r.ajax({url:"/api/ucdn/traffic",data:{use_session:"yes",format:"json"},type:"GET",cache:!1,async:e?!1:!0,dataType:"json",success:function(e){e.ret_code==0&&t.set(e.data)},error:function(e){}})},priceCount:function(e){var t;return r.ajax({url:"/api/ucdn/price_count",data:{traffic:e,use_session:"yes",format:"json"},type:"GET",cache:!1,async:!1,dataType:"json",success:function(e){e.ret_code==0&&(t=e.data)}}),{total_price:t,price:(parseFloat(t)/parseFloat(e)).toFixed(2)}}}),t.Models.TraffcAlarm=s.Model.extend({getAlarmConfigByCdnDomain:function(e){var t=this;r.ajax({url:"/api/ucdn/alarm",data:{cdn_domain:e,use_session:"yes",format:"json"},type:"GET",cache:!1,async:!1,dataType:"json",success:function(e){e.ret_code==0&&t.set(e.data)}})}}),t.Models.UcdnLog=s.Model.extend({getTemplateJson:function(){var e=this.toJSON();return e.title=e.log_name.slice(e.log_name.lastIndexOf("/")+1),e}}),t.Models.UcdnLogAnalysisDomain=s.Model.extend({getTemplateJson:function(){var e=this.toJSON();return e}}),t.Models.UcdnLogAnalysis=s.Model.extend({getTemplateJson:function(){var e=this.toJSON();return e}}),t.Models.AccountTransaction=s.Model.extend({getTemplateJson:function(){var e=this.toJSON();e.create_time=r.format.date(new Date(parseInt(e.create_time)*1e3),"yyyy-MM-dd HH:mm");switch(e.pay_platform){case 10:e.pay_platform="支付宝";break;default:e.pay_platform=""}switch(e.transaction_type){case 1:e.transaction_type="扣款";break;case 2:e.transaction_type="充值"}return e}}),t.Models.AccountBill=s.Model.extend({getTemplateJson:function(){var e=this.toJSON();t.vmtypes||(t.vmtypes=new t.Collections.VmType,t.vmtypes.getList(0,!0));var n=t.vmtypes.where({id:e.vm_type});e.cost=(parseFloat(e.cost)/100).toFixed(2),e.price=(parseFloat(e.price)/100).toFixed(2);switch(e.charge_type){case 1:e.price+="元/小时",e.charge_type="小时";break;case 2:e.price+="元/月",e.charge_type="月";break;case 3:e.price+="元/年",e.charge_type="年"}return n.length&&(e.vm_type_name=n[0].get("name")),e}}),t.Models.SchedulerRule=s.Model.extend({defaults:{selected:!1},getTemplateJson:function(){var e=this.toJSON();switch(e.obj_type){case 2:e.obj_type_lable="组",e.obj_name=this.getTagById(e.obj_id);break;case 1:e.obj_type_lable="主机",e.obj_name=this.getVmById(e.obj_id)}return e},getTagById:function(e){t.Tags||(t.Tags=new t.Collections.Tag,t.Tags.getList(!0));var n=t.Tags.where({tag_id:parseInt(e)});return n.length?n[0].get("tag_name"):"无绑定对象"},getVmById:function(e){t.Uhost||(t.Uhost=new t.Collections.Uhost,t.Uhost.getList(!0));var n=t.Uhost.where({vmid:e});return n.length?n[0].get("hostname"):"无绑定对象"}}),t.Models.SchedulerAction=s.Model.extend({defaults:{selected:!1},getTemplateJson:function(){var e=this.toJSON();return e}}),t.Models.ConsoleLog=s.Model.extend({getTemplateJson:function(){var e=this.toJSON();switch(e.action_type){case 0:e.action_type="其他操作";break;case 1:e.action_type="分配主机";break;case 2:e.action_type="关机";break;case 3:e.action_type="开机";break;case 4:e.action_type="列表";break;case 5:e.action_type="删除";break;case 6:e.action_type="重启"}return e.action_time=r.format.date(new Date(parseInt(e.action_time)*1e3),"yyyy-MM-dd HH:mm"),e}}),t.Collections=t.Collections||{},t.Collections.Isp=s.Collection.extend({model:t.Models.Isp}),t.Collections.Uhost=s.Collection.extend({model:t.Models.Uhost,getList:function(e){var t=this;r.ajax({url:"/api/instances",data:{use_session:"yes",format:"json"},type:"GET",cache:!1,async:e?!1:!0,dataType:"json"}).done(function(e){e.ret_code==0&&t.reset(e.data)})}}),t.Collections.VmType=s.Collection.extend({model:t.Models.VmType,getList:function(e,t){var n=this;r.ajax({url:"/api/vmtypes",data:{use_session:"yes",format:"json"},type:"GET",cache:!1,dataType:"json",async:t?!1:!0,success:function(t){if(t.ret_code==0)if(e){var r=i.filter(t.data,function(t){if(parseInt(t.disk_space_unit)>=parseInt(e))return!0});n.reset(r)}else n.reset(t.data)},error:function(e){n.trigger("flash",{error:!0})}})}}),t.Collections.Image=s.Collection.extend({model:t.Models.Image,getList:function(e){var t=this;r.ajax({url:"/api/uimages",data:{use_session:"yes",format:"json"},type:"GET",cache:!1,dataType:"json",async:e?!1:!0,success:function(e){if(e.ret_code==0){var n=i.filter(e.data,function(e){return e.state==0});t.reset(n)}},error:function(e){t.trigger("flash",{error:!0})}})},getListByCustomType:function(){var e=this;r.ajax({url:"/api/uimages",data:{use_session:"yes",format:"json"},type:"GET",cache:!1,dataType:"json",success:function(t){if(t.ret_code==0){var n=i.filter(t.data,function(e){return e.image_type==2});e.reset(n)}},error:function(t){e.trigger("flash",{error:!0})}})},getImageById:function(e){var t;return r.ajax({url:"/api/uimage",data:{image_id:e,use_session:"yes",format:"json"},type:"GET",cache:!1,async:!1,dataType:"json",success:function(e){e.ret_code==0&&(t=e.data)},error:function(e){that.trigger("flash",{error:!0})}}),t},comparator:function(e){return e.get("name")}}),t.Collections.Ufirewall=s.Collection.extend({model:t.Models.Ufirewall,getList:function(e){var t=this;r.ajax({url:"/api/ufirewall",data:{use_session:"yes",format:"json"},type:"GET",cache:!1,dataType:"json",async:e?!1:!0,success:function(e){e.ret_code==0&&t.reset(e.data)},error:function(e){t.trigger("flash",{error:!0})}})},comparator:function(e){return e.get("name")}}),t.Collections.Udb=s.Collection.extend({model:t.Models.Udb,getList:function(){var e=this,t=new Array;r.ajax({url:"/api/udb/instances",data:{use_session:"yes",format:"json",db_kind:"2"},type:"GET",cache:!1,dataType:"json",success:function(n){if(n.ret_code==0){t=n.data,e.reset(t);for(var i=0;i<t.length;i++){t[i].src_id=t[i].db_id;if(t[i].slave_db_info.length){t[i].slave_db_lable=1;for(var s=0;s<t[i].slave_db_info.length;s++)e.add(t[i].slave_db_info[s])}}r.ajax({url:"/api/udb/instancetypes",data:{use_session:"yes",format:"json"},type:"GET",cache:!1,async:!1,dataType:"json",success:function(n){if(n.ret_code==0){for(var r=0;r<t.length;r++)for(var i=0;i<n.data.length;i++){t[r].instance_type_id==n.data[i].id&&(t[r].instance_type_name=n.data[i].name,t[r].diskspace=n.data[i].diskspace,t[r].memory=n.data[i].memory);if(t[r].slave_db_info)for(var s=0;s<t[r].slave_db_info.length;s++)t[r].slave_db_info[s].instance_type_id==n.data[i].id&&(t[r].slave_db_info[s].instance_type_name=n.data[i].name,t[r].slave_db_info[s].diskspace=n.data[i].diskspace,t[r].slave_db_info[s].memory=n.data[i].memory)}e.reset(t);for(var r=0;r<t.length;r++)if(t[r].slave_db_info)for(var i=0;i<t[r].slave_db_info.length;i++)e.add(t[r].slave_db_info[i])}},error:function(e){}}),r.ajax({url:"/api/udb/clustertypes",data:{use_session:"yes",format:"json"},type:"GET",cache:!1,dataType:"json",success:function(n){if(n.ret_code==0){var i=0,s=0,o=new Array,u=n.data;for(s=0;s<u.length;s++)r.ajax({url:"/api/udb/factorytypes",data:{cluster_id:u[s].id,use_session:"yes",format:"json"},type:"GET",cache:!1,dataType:"json",success:function(n){if(n.ret_code==0){if(n.data.length)for(var r=0;r<n.data.length;r++){for(var s=0;s<u.length;s++)u[s].id==n.data[r].cluster_id&&(n.data[r].cluster_name=u[s].name);o[i]=n.data[r],i+=1}if(c=u.length-1){for(var a=0;a<t.length;a++)for(var f=0;f<o.length;f++){t[a].db_type_id==o[f].id&&(t[a].db_type_name=o[f].name,t[a].db_type=o[f].cluster_name);if(t[a].slave_db_info)for(var l=0;l<t[a].slave_db_info.length;l++)t[a].slave_db_info[l].db_type_id==o[f].id&&(t[a].slave_db_info[l].db_type_name=o[f].name,t[a].slave_db_info[l].db_type=o[f].cluster_name)}e.reset(t);for(var c=0;c<t.length;c++)if(t[c].slave_db_info)for(var r=0;r<t[c].slave_db_info.length;r++)e.add(t[c].slave_db_info[r])}}},error:function(e){}})}},error:function(e){}}),r.ajax({url:"/api/udb/param",data:{offset:0,max_count:999,use_session:"yes",format:"json"},type:"GET",cache:!1,async:!1,dataType:"json",success:function(n){if(n.ret_code==0){for(var r=0;r<t.length;r++)for(var i=0;i<n.data.length;i++){t[r].param_group_id==n.data[i].id&&(t[r].param_group_name=n.data[i].name);for(var s=0;s<t[r].slave_db_info.length;s++)t[r].slave_db_info[s].param_group_id==n.data[i].id&&(t[r].slave_db_info[s].param_group_name=n.data[i].name)}e.reset(t);for(var r=0;r<t.length;r++)if(t[r].slave_db_info.length){t[r].slave_db_lable=1;for(var i=0;i<t[r].slave_db_info.length;i++)e.add(t[r].slave_db_info[i])}}},error:function(e){}})}},error:function(e){}})},comparator:function(e){return e.get("src_id")}}),t.Collections.DbInstance=s.Collection.extend({model:t.Models.DbInstance,getList:function(){var e=this;r.ajax({url:"/api/udb/instances",data:{use_session:"yes",format:"json",db_kind:"2"},type:"GET",cache:!1,dataType:"json",success:function(t){t.ret_code==0&&e.reset(t.data)},error:function(e){}})}}),t.Collections.DbType=s.Collection.extend({model:t.Models.DbType,getList:function(){var e=this;r.ajax({url:"/api/udb/clustertypes",data:{use_session:"yes",format:"json"},type:"GET",cache:!1,async:!1,dataType:"json",success:function(t){if(t.ret_code==0){var n=0,i=0,s=t.data;for(i=0;i<s.length;i++)r.ajax({url:"/api/udb/factorytypes",data:{cluster_id:s[i].id,use_session:"yes",format:"json"},type:"GET",cache:!1,async:!1,dataType:"json",success:function(t){if(t.ret_code==0){for(var n=0;n<t.data.length;n++)for(var r=0;r<s.length;r++)s[r].id==t.data[n].cluster_id&&(t.data[n].cluster_name=s[r].name);s[i].factorytype_list=t.data,(i=s.length-1)&&e.reset(s)}},error:function(e){}})}},error:function(e){}})}}),t.Collections.FactoryType=s.Collection.extend({model:t.Models.FactoryType,getList:function(e){var t=this;r.ajax({url:"/api/udb/factorytypes",data:{cluster_id:e,use_session:"yes",format:"json"},type:"GET",cache:!1,dataType:"json",success:function(e){e.ret_code==0&&t.reset(e.data)},error:function(e){}})}}),t.Collections.InstanceType=s.Collection.extend({model:t.Models.InstanceType,getList:function(){var e=this;r.ajax({url:"/api/udb/instancetypes",data:{use_session:"yes",format:"json"},type:"GET",cache:!1,dataType:"json",success:function(t){t.ret_code==0&&e.reset(t.data)},error:function(e){}})}}),t.Collections.ParamGroup=s.Collection.extend({model:t.Models.ParamGroup,getList:function(e){var t=this;r.ajax({url:"/api/udb/param",data:{offset:0,max_count:999,use_session:"yes",format:"json"},type:"GET",cache:!1,async:!1,dataType:"json",success:function(n){if(n.ret_code==0)if(e){var r=new Array;for(var i=0,s=0;i<n.data.length;i++)n.data[i].factory_id==e&&(r[s]=n.data[i],s++);t.reset(r)}else t.reset(n.data)},error:function(e){}})}}),t.Collections.BackupType=s.Collection.extend({model:t.Models.BackupType,getList:function(){var e=new Array;e[0]=new Array,e[0].id=1,e[0].description="每周备份7次，每天3点开始，每隔24小时备份一次",this.reset(e)}}),t.Collections.Backup=s.Collection.extend({model:t.Models.Backup,getList:function(e){var t=this;e||r.ajax({url:"/api/udb/instances",data:{use_session:"yes",format:"json",db_kind:"2"},type:"GET",cache:!1,async:!1,dataType:"json",success:function(t){t.ret_code==0&&(e=t.data[0].db_id)},error:function(e){}}),r.ajax({url:"/api/udb/backup",data:{use_session:"yes",offset:0,max_count:999,db_id:e,format:"json"},type:"GET",cache:!1,dataType:"json",success:function(e){e.ret_code==0&&t.reset(e.data)},error:function(e){t.trigger("flash",{error:!0})}})}}),t.Collections.Param=s.Collection.extend({model:t.Models.Param,getList:function(){var e=this,t=new Array;r.ajax({url:"/api/udb/param",data:{use_session:"yes",offset:0,max_count:999,format:"json"},type:"GET",cache:!1,dataType:"json",success:function(n){n.ret_code==0&&(t=n.data,e.reset(t),r.ajax({url:"/api/udb/clustertypes",data:{use_session:"yes",format:"json"},type:"GET",cache:!1,dataType:"json",success:function(n){if(n.ret_code==0){var i=0,s=0,o=new Array,u=n.data;for(s=0;s<u.length;s++)r.ajax({url:"/api/udb/factorytypes",data:{cluster_id:u[s].id,use_session:"yes",format:"json"},type:"GET",cache:!1,dataType:"json",success:function(n){if(n.ret_code==0){if(n.data.length)for(var r=0;r<n.data.length;r++){for(var a=0;a<u.length;a++)u[a].id==n.data[r].cluster_id&&(n.data[r].cluster_name=u[a].name);o[i]=n.data[r],i+=1}if(s=u.length-1){for(var f=0;f<t.length;f++)for(var l=0;l<o.length;l++)t[f].factory_id==o[l].id&&(t[f].db_type_name=o[l].name,t[f].db_type=o[l].cluster_name);e.reset(t)}}},error:function(e){}})}},error:function(e){}}))},error:function(t){e.trigger("flash",{error:!0})}})},comparator:function(e){return e.get("id")}}),t.Collections.Udisk=s.Collection.extend({model:t.Models.Udisk,getList:function(){var e=this;r.ajax({url:"/api/udisks",data:{use_session:"yes",offset:0,max_count:20,format:"json"},type:"GET",cache:!1,dataType:"json",success:function(t){t.ret_code==0&&e.reset(t.data)},error:function(t){e.trigger("flash",{error:!0})}})}}),t.Collections.Snapshot=s.Collection.extend({model:t.Models.Snapshot,getList:function(){var e=this;r.ajax({url:"/api/snapshots",data:{use_session:"yes",offset:0,max_count:20,format:"json"},type:"GET",cache:!1,dataType:"json",success:function(t){t.ret_code==0&&e.reset(t.data)},error:function(t){e.trigger("flash",{error:!0})}})}}),t.Collections.NetInfo=s.Collection.extend({model:t.Models.NetInfo,getList:function(e){var t=this;r.ajax({url:"/api/netinfo",data:{use_session:"yes",offset:0,max_count:20,format:"json"},type:"GET",cache:!1,dataType:"json",async:e?!1:!0,success:function(e){e.ret_code==0&&t.reset(e.data[0].net_type)},error:function(e){t.trigger("flash",{error:!0})}})}}),t.Collections.UfirewallRule=s.Collection.extend({model:t.Models.UfirewallRule,getList:function(e,t){var n=this;r.ajax({url:"/api/ufirewall/rules",data:{group_id:e,use_session:"yes",offset:0,max_count:20,format:"json"},type:"GET",cache:!1,dataType:"json",async:t?!1:!0,success:function(e){e.ret_code==0&&n.reset(e.data)},error:function(e){n.trigger("flash",{error:!0})}})}}),t.Collections.Probe=s.Collection.extend({model:t.Models.Probe,getList:function(e,t){var n=this;r.ajax({url:"/api/monitor/probes",data:{group_id:e,use_session:"yes",offset:0,max_count:20,format:"json"},type:"GET",cache:!1,dataType:"json",async:t?!1:!0,success:function(e){e.ret_code==0&&n.reset(e.data)},error:function(e){n.trigger("flash",{error:!0})}})}}),t.Collections.AlarmTarget=s.Collection.extend({getList:function(e){var t=this;r.ajax({url:"/api/monitor/target",data:{use_session:"yes",format:"json"},type:"GET",cache:!1,dataType:"json",async:e?!1:!0,success:function(e){e.ret_code==0&&(t.target=e.data)},error:function(e){t.trigger("flash",{error:!0})}})},hasMail:function(){return this.target&&this.target.mail.length?!0:!1},hasPhone:function(){return this.target&&this.target.phone.length?!0:!1},getMail:function(){return this.target&&this.target.mail.length?this.target.mail:!1},getPhone:function(){return this.target&&this.target.phone.length?this.target.phone:!1},getMail2:function(){var e=[],t=0,n;return this.target&&this.target.mail.length&&i.each(this.target.mail,function(r){t==0?(n=!0,e.push({mail:r,_first:n})):(n=!1,e.push({mail:r,_first:n})),t+=1}),e},getPhone2:function(){var e=[],t=0,n;return this.target&&this.target.phone.length&&i.each(this.target.phone,function(r){t==0?(n=!0,e.push({phone:r,_first:n})):(n=!1,e.push({phone:r,_first:n})),t+=1}),e}}),t.Collections.Indicator=s.Collection.extend({model:t.Models.Indicator,getList:function(e){var t=this;r.ajax({url:"/api/monitor/indicators",data:{use_session:"yes",format:"json"},type:"GET",cache:!1,dataType:"json",async:e?!1:!0,success:function(e){e.ret_code==0&&t.reset(e.data)},error:function(e){t.trigger("flash",{error:!0})}})}}),t.Collections.Tag=s.Collection.extend({model:t.Models.Tag,getList:function(e){var t=this;r.ajax({url:"/api/tags",data:{use_session:"yes",format:"json"},type:"GET",cache:!1,dataType:"json",async:e?!1:!0,success:function(e){e.ret_code==0&&t.reset(e.data)},error:function(e){t.trigger("flash",{error:!0})}})}}),t.Collections.MonitorCurrentData=s.Collection.extend({model:t.Models.MonitorCurrentData,getList:function(e){var t=this;r.ajax({url:"/api/monitor/current_monitor_data",data:{use_session:"yes",format:"json"},type:"GET",cache:!1,dataType:"json",async:e?!1:!0,success:function(e){e.ret_code==0&&t.reset(e.data)},error:function(e){t.trigger("flash",{error:!0})}})}}),t.Collections.Palarm=s.Collection.extend({model:t.Models.Palarm,getList:function(e){var t=this;r.ajax({url:"/api/monitor/palarm",data:{offset:0,max_count:1e3,begin_time:e.begin_time,end_time:e.end_time,alarm_type:e.alarm_type,use_session:"yes",format:"json"},type:"GET",cache:!1,dataType:"json",success:function(e){e.ret_code==0&&t.reset(e.data)},error:function(e){t.trigger("flash",{error:!0})}})}}),t.Collections.Ucdn=s.Collection.extend({model:t.Models.Ucdn,getList:function(e){var t=this;r.ajax({url:"/api/ucdn/sites",data:{offset:0,offset:100,use_session:"yes",format:"json"},type:"GET",cache:!1,dataType:"json",async:e?!1:!0,success:function(e){e.ret_code==0&&t.reset(e.data)},error:function(e){t.trigger("flash",{error:!0})}})}}),t.Collections.UcdnLog=s.Collection.extend({model:t.Models.UcdnLog,getList:function(e){var t=this;e.use_session="yes",e.format="json",r.ajax({url:"/api/ucdn/log",data:e,type:"GET",cache:!1,dataType:"json",success:function(e){e.ret_code==0&&t.reset(e.data.log_info)},error:function(e){t.trigger("flash",{error:!0})}})}}),t.Collections.UcdnLogAnalysis=s.Collection.extend({model:t.Models.UcdnLogAnalysis,getList:function(e){var t=this;e.use_session="yes",e.format="json",r.ajax({url:"/api/ucdn/loganalysis",data:e,type:"GET",cache:!1,datatype:"json",success:function(e){if(e.ret_code==0){for(var n=0;n<e.data.length;n++)e.data[n].index=n+1,e.data[n].file_traffic=e.data[n].file_traffic+"MB";t.reset(e.data)}else t.trigger("flash",{error:!0})},error:function(e){t.trigger("flash",{error:!0})}})}}),t.Collections.UcdnLogAnalysisDomain=s.Collection.extend({model:t.Models.UcdnLogAnalysisDomain,getList:function(e){var t=this,n=Object();n.use_session="yes",n.format="json",r.ajax({url:"/api/ucdn/loganalysisdomain",data:n,type:"GET",cache:!1,async:e?!1:!0,datatype:"json",success:function(e){if(e.ret_code==0){var n=e.data;for(var r=0;r<n.length;r++){var i=Object();i.cdn_domain=n[r],e.data[r]=i}t.reset(e.data)}else t.trigger("flash",{error:!0})},error:function(e){t.trigger("flash",{error:!0})}})}}),t.Collections.AccountTransaction=s.Collection.extend({model:t.Models.AccountTransaction,getList:function(e,t,n,i,s){var o=this;return e=Date.parse(e)/1e3,t=Date.parse(t)/1e3,r.ajax({url:"/account/user/getAccountTransaction",data:{start_time:e,end_time:t,bill_type:n,offset:i,max_count:s},type:"POST",dataType:"json",success:function(e){o.reset(e)}}),this.total_count},getCount:function(e,t,n){var i=this;return e=Date.parse(e)/1e3,t=Date.parse(t)/1e3,r.ajax({url:"/account/user/getAccountTransactionCount",data:{start_time:e,end_time:t,bill_type:n},type:"POST",async:!1,dataType:"json",success:function(e){i.total_count=e}}),this.total_count}}),t.Collections.AccountBill=s.Collection.extend({model:t.Models.AccountBill,getList:function(e){var t=this;r.ajax({url:"/account/user/getBillItem",data:{bill_time:e},type:"GET",dataType:"json",cache:!1,async:!1,success:function(e){t.total=e.total,t.reset(e.uhost.uhost_bill)}})}}),t.Collections.SchedulerRule=s.Collection.extend({model:t.Models.SchedulerRule,getList:function(){var e=this;r.ajax({url:"/api/monitor/schedulerrules",type:"GET",data:{use_session:"yes",format:"json"},dataType:"json",cache:!1,async:!1,success:function(t){e.reset(t.data)}})}}),t.Collections.SchedulerAction=s.Collection.extend({model:t.Models.SchedulerAction,getList:function(){var e=this;r.ajax({url:"/api/monitor/scheduleractions",type:"GET",data:{use_session:"yes",format:"json"},dataType:"json",cache:!1,async:!1,success:function(t){e.reset(t.data)}})}}),t.Collections.ConsoleLog=s.Collection.extend({model:t.Models.ConsoleLog,getList:function(e,t,n){var i=this;r.ajax({url:"/api/instance/consolelog_count",type:"GET",data:{use_session:"yes",format:"json",begin_time:e,end_time:t,vmid:n},dataType:"json",cache:!1,global:!1}).done(function(s){s.ret_code==0&&r.ajax({url:"/api/instance/consolelog",type:"GET",data:{use_session:"yes",format:"json",begin_time:e,end_time:t,vmid:n,offset:0,max_count:s.data},dataType:"json",cache:!1,async:!1,global:!1}).done(function(e){e.ret_code==0&&i.reset(e.data)})})}})});